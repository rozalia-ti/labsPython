# Лабораторная работа №7
### Выполнила Тихонова Роза 501455 Р3122
-------------------------
### Архитектура проекта
*currencies.py* - файл с реализацией функции без логгера

*logger.py* — параметризуемый декоратор для логирования вызовов функций

*get_currencies* — получение курсов валют с API ЦБ РФ

*square.py* — решение квадратного уравнения с логированием

*tests_currencies.py* и *tests_logger.py* — тестирование декоратора и функции get_currencies

*currency_file.txt* — log-журнал для логиррования в файл.

*file_logger.py* - декоратор, логирующий в файл.

## Файлы
### logger.py
Реализация параметризуемого декоратора logger для логирования вызовов функций с поддержкой трех вариантов логирования: стандартный вывод, объекты файлового интерфейса и модуль logging.

#### Основные функции
``` logger(handle=sys.stdout) ```
Принцип работы: В зависимости от типа параметра handle выбирает соответствующий метод записи логов.

*Параметры:*

handle (объект, по умолчанию sys.stdout): Целевой объект для логирования:

TextIOWrapper или StringIO — логирование через метод write()

logging.Logger — логирование через методы info() и error()

Любой другой тип — вызывает исключение Exception

Возвращаемое значение: Декоратор-обертка для функции.

*Особенности:*

Использует functools.wraps для сохранения метаданных оригинальной функции

Автоматически определяет тип handle с помощью match-case

Логирует начало и конец выполнения функции

Перехватывает исключения, логирует их и повторно выбрасывает

Форматирует параметры функции с помощью inspect.signature

*Типы данных:*

Входные параметры: Любые аргументы, поддерживаемые декорируемой функцией

Возвращаемое значение: Результат выполнения декорируемой функции

*Запуск*
```py logger.py```

###  currencies.py
Реализация функции get_currencies для получения курсов валют с API Центрального Банка РФ с использованием декоратора логирования.

#### Основные функции
```get_currencies(currency_codes=default_list, url="https://www.cbr.ru/scripts/XML_daily.asp")```
*Назначение:* Получение курсов указанных валют с API ЦБ РФ.
*Принцип работы:* Выполняет HTTP-запрос к API, парсит XML-ответ, извлекает курсы валют и возвращает их в виде словаря.

*Параметры:*

currency_codes (List[str], по умолчанию default_list): Список кодов валют для получения (например, ['USD', 'EUR'])

url (str, по умолчанию "https://www.cbr.ru/scripts/XML_daily.asp"): URL API ЦБ РФ

Возвращаемое значение: Dict[str, float] — словарь, где ключи — коды валют, значения — курсы валют к рублю.

Обрабатываемые исключения:

ConnectionError — если API недоступен или произошла ошибка соединения

ValueError — если получен некорректный JSON/XML

KeyError — если отсутствует ключ "Valute" или запрашиваемая валюта

TypeError — если курс валюты имеет неверный тип данных

*Типы данных:*

default_list: List[str] — предопределенный список из 25 популярных валют

Входные параметры: Список строковых кодов валют и URL API

Возвращаемое значение: Словарь {код_валюты: курс}

*Особенности:*

Использует библиотеки requests для HTTP-запросов и BeautifulSoup для парсинга XML

Преобразует строковые значения курсов (с запятой как разделителем) в float

Логирование осуществляется через декоратор @logger

Поддерживается три варианта логирования (указаны в коде)

*Запуск*
```py currencies.py```

### get_currencies.py
Чистая реализация функции get_currencies без декоратора логирования. Используется как основа для тестирования и демонстрации работы декоратора.

*Основные функции*
```get_currencies(currency_codes=default_list, url="https://www.cbr.ru/scripts/XML_daily.asp")```
Назначение: Та же функциональность, что и в currencies.py, но без декоратора логирования.
Принцип работы: Аналогично функции в currencies.py, но выводит результат напрямую в консоль.

*Параметры:*
Совпадают с параметрами функции в currencies.py
Возвращаемое значение: Совпадает с возвращаемым значением в currencies.py

*Особенности:*

Не использует декоратор логирования

Выводит результат в консоль командой print(rates)

Используется для тестирования чистой бизнес-логики

Содержит обработку исключений с выводом сообщений в консоль

*Команда запуска:*
```py get_currencies.py```

### square.py
Демонстрация файлового логирования с использованием модуля logging. Создает логгер с записью в файл и применяет его к функции get_currencies.

*Основные функции*
```logger(func=None, *, handle=sys.stdout)```
*Назначение:* Упрощенная версия декоратора логирования с акцентом на работу с модулем logging.
Принцип работы: Проверяет, является ли handle объектом logging.Logger, и в этом случае настраивает файловый хендлер.

*Параметры:*

```func (callable, optional): ```
Декорируемая функция

handle (объект, по умолчанию sys.stdout): Объект для логирования

*Особенности:*

Создает файл currency_file.txt для записи логов

Настраивает FileHandler для логгера

Записывает логи только при использовании logging.Logger

Выводит предупреждение при других типах handle

get_currencies(...)
Назначение: Та же функциональность получения курсов валют.
Принцип работы: Аналогично основной реализации.

*Типы данных:*

file_logger: logging.Logger — логгер для записи в файл

Файл вывода: currency_file.txt — текстовый файл с логами

*Команда запуска:*

```py file_logger.py```

### tests_currencies.py
Юнит-тесты для функции get_currencies. Проверяет корректность работы функции в различных сценариях.

*Основные функции*
```TestGetCurrencies(unittest.TestCase)```
*Назначение:*
Класс тестов для проверки функции получения курсов валют.

*Методы тестирования:*

__test_get_currencies_correct_return()__ — тест корректного возврата курсов

__test_get_currencies_with_default_list()__ — тест с параметрами по умолчанию

__test_get_currencies_nonexistent_currency()__ — тест с несуществующей валютой

__test_get_currencies_connection_error()__ — тест ошибки соединения

__test_get_currencies_value_error_on_invalid_xml()__ — тест некорректного XML

__test_get_currencies_key_error_on_missing_valute()__ — тест отсутствия тега Valute

__test_get_currencies_type_error_on_invalid_rate()__ — тест некорректного значения курса

__test_get_currencies_specific_currency_subset()__ — тест подмножества валют

*Принцип работы:* 
Использует unittest.mock.patch для мокирования HTTP-запросов и изоляции тестов от внешних зависимостей.

*Особенности:*

Использует mock-данные XML ответов

Проверяет все типы исключений, указанные в задании

Тестирует как успешные сценарии, так и обработку ошибок

Использует assertRaises для проверки исключений

*Команда запуска:*
```py tests_currencies.py```

### tests_logger.py
Юнит-тесты для декоратора logger. Проверяет корректность логирования в различных сценариях.

*Основные функции*
```Test(unittest.TestCase)```
Класс тестов для проверки работы декоратора логирования.

*Методы тестирования:*

__test_setUp()__ — тест успешного выполнения функции с логированием

__test_error()__ — тест логирования при возникновении исключения

*Принцип работы:* 
Использует io.StringIO() для перехвата вывода декоратора и проверки корректности записанных логов.

*Особенности:*

Проверяет форматирование сообщений

Убеждается, что исключения пробрасываются после логирования

Использует dedent для удобного сравнения многострочных строк

Тестирует оба сценария: успешное выполнение и ошибку

*Типы данных:*

self.stream: io.StringIO — буфер для перехвата вывода

Ожидаемые значения: Отформатированные строки логов

Команда запуска:
```py tests_logger.py```

### currency_file.txt
Файл с логами, сгенерированный при работе функции get_currencies с файловым логированием.

*Содержание*
Записи о вызовах функции get_currencies с указанием:

Параметров вызова (список валют и URL)

Особенности:

Автоматически создается при запуске __file_logger.py__

Содержит историю вызовов функции

Может использоваться для отладки и анализа работы приложения

## Требования к окружению
- Установленные зависимости:
```pip install requests beautifulsoup4```
- python 3.8 и выше
- Доступ к интернету для работы с API ЦБ РФ